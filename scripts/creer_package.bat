@echo off
chcp 65001 >nul
echo.
echo ???????????????????????????????????????????????????????????
echo   ?? CRÉATION DU PACKAGE ZIP - DÉMINEUR HD
echo ???????????????????????????????????????????????????????????
echo.

REM Vérifier si le dossier Release existe
if not exist "Release\" (
    echo ? ERREUR: Le dossier Release\ n'existe pas !
    echo.
    echo ?? Lancez d'abord: build_release.bat
    echo.
    pause
    exit /b 1
)

REM Vérifier si demineur.exe existe
if not exist "Release\demineur.exe" (
    echo ? ERREUR: demineur.exe introuvable dans Release\ !
    echo.
    echo ?? Compilez d'abord le projet:
    echo    - Ouvrez Visual Studio
    echo    - Configuration: Release
    echo    - Appuyez sur Ctrl+Shift+B
    echo    - Puis lancez: organiser_projet.bat
    echo.
    pause
    exit /b 1
)

echo ?? Contenu du package:
echo.
dir /B "Release"
echo.

REM Demander confirmation
set /p confirm="Créer le .zip ? (O/N): "
if /i not "%confirm%"=="O" (
    echo.
    echo ? Création annulée.
    pause
    exit /b 0
)

echo.
echo ?? Création du package...
echo.

REM Supprimer l'ancien .zip s'il existe
if exist "Demineur_HD_v1.0.zip" (
    echo ???  Suppression de l'ancien .zip...
    del "Demineur_HD_v1.0.zip"
)

REM Créer le .zip avec PowerShell
powershell -Command "Compress-Archive -Path 'Release\*' -DestinationPath 'Demineur_HD_v1.0.zip' -Force"

if %ERRORLEVEL% EQU 0 (
    echo.
    echo ???????????????????????????????????????????????????????????
    echo   ? PACKAGE CRÉÉ AVEC SUCCÈS !
    echo ???????????????????????????????????????????????????????????
    echo.
    echo ?? Fichier: Demineur_HD_v1.0.zip
    
    REM Afficher la taille
    for %%A in ("Demineur_HD_v1.0.zip") do (
        set size=%%~zA
    )
    echo ?? Taille: %size% octets
    echo.
    
    REM Proposer d'ouvrir l'explorateur
    set /p open="Ouvrir le dossier ? (O/N): "
    if /i "%open%"=="O" (
        explorer /select,"Demineur_HD_v1.0.zip"
    )
) else (
    echo.
    echo ? ERREUR: Échec de la création du .zip !
    echo.
)

echo.
pause
